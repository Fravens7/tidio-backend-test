<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cashback Input Flow</title>
  <style>
    #chatSystem {
      display: inline-block;
      margin-left: 10px;
      font-weight: bold;
      color: blue;
    }
    #container {
      display: flex;
      align-items: center;
      margin-top: 20px;
    }
    input {
      width: 200px;
      padding: 5px;
    }
    button {
      padding: 5px 10px;
      margin-left: 5px;
    }
  </style>
</head>
<body>
  <h2>Simulaci√≥n Cashback con un solo Input</h2>

  <div id="container">
    <input type="text" id="mensaje" placeholder="Escribe tu mensaje aqu√≠..." />
    <button onclick="procesarInput()">Enviar</button>
    <span id="chatSystem">Escribe tu mensaje</span>
  </div>

  <div id="chatLog" style="margin-top:20px;"></div>

  <script>
    let estado = "inicio"; // inicio, esperandoPromocion, esperandoMonto
    let promocionSeleccionada = null;

    const MIN_CASHBACK = 10;
    const MAX_CASHBACK_CHICKEN = 5000;
    const PERCENT_CHICKEN = 0.10;

    function limpiarInput() {
      document.getElementById("mensaje").value = "";
    }

    function actualizarSistema(texto) {
      document.getElementById("chatSystem").textContent = texto;
    }

    function procesarInput() {
      const input = document.getElementById("mensaje").value.trim();
      if (!input) return;

      const chatLog = document.getElementById("chatLog");
      chatLog.innerHTML += `<p><b>T√∫:</b> ${input}</p>`;

      switch(estado) {
        case "inicio":
          if (input.toLowerCase().includes("cashback")) {
            actualizarSistema("Qu√© promoci√≥n quieres, Slots o Chicken Dash?");
            estado = "esperandoPromocion";
          } else {
            actualizarSistema("No entiendo tu mensaje a√∫n.");
          }
          break;

        case "esperandoPromocion":
          if (input.toLowerCase() === "slots" || input.toLowerCase() === "chicken dash") {
            promocionSeleccionada = input.toLowerCase();
            actualizarSistema("Coloque el monto perdido:");
            estado = "esperandoMonto";
          } else {
            actualizarSistema("Por favor, escribe 'Slots' o 'Chicken Dash'");
          }
          break;

        case "esperandoMonto":
          const monto = parseFloat(input);
          if (isNaN(monto) || monto <= 0) {
            actualizarSistema("Ingresa un monto v√°lido mayor a 0");
            break;
          }

          let reply = "";
          if (promocionSeleccionada === "chicken dash") {
            let cashback = monto * PERCENT_CHICKEN;
            if (cashback >= MAX_CASHBACK_CHICKEN) cashback = MAX_CASHBACK_CHICKEN;
            if (cashback < MIN_CASHBACK) cashback = MIN_CASHBACK;

            reply = `üéâ Chicken Dash\nMonto ingresado: ${monto} BDT\nPorcentaje aplicado: ${PERCENT_CHICKEN*100}%\nTotal cashback: ${cashback.toFixed(2)} BDT`;
          } else if (promocionSeleccionada === "slots") {
            let porcentaje = 0;
            if (monto <= 250000) porcentaje = 0.06;
            else if (monto <= 500000) porcentaje = 0.08;
            else if (monto <= 1000000) porcentaje = 0.10;
            else porcentaje = 0.12;

            let cashback = monto * porcentaje;
            if (cashback < MIN_CASHBACK) cashback = MIN_CASHBACK;

            reply = `üé∞ Slots Weekly\nMonto ingresado: ${monto} BDT\nPorcentaje aplicado: ${porcentaje*100}%\nTotal cashback: ${cashback.toFixed(2)} BDT`;
          }

          chatLog.innerHTML += `<p><b>Calculadora:</b><br>${reply.replace(/\n/g,"<br>")}</p>`;
          actualizarSistema("Escribe tu mensaje"); // reinicia instrucciones
          promocionSeleccionada = null;
          estado = "inicio";
          break;

        default:
          actualizarSistema("No entiendo tu mensaje a√∫n.");
      }

      limpiarInput();
    }
  </script>
  <script src="test-backend.js"></script>

</body>
</html>
